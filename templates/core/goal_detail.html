{% extends 'core/base.html' %}
{% block title %}{{ goal.title }} - Progress Autopilot{% endblock %}
{% block content %}

<div style="margin-bottom: 2rem;">
  <a href="{% url 'goal_list' %}" style="color: var(--accent-primary); text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
    â† Back to Goals
  </a>
  
  <h1 style="margin-bottom: 0.5rem;">{{ goal.title }}</h1>
  <p style="color: var(--text-muted);">{{ goal.description }}</p>
</div>

<div class="row">
  <div>
    <!-- Steps Section -->
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="margin: 0;">ğŸ“‹ Steps</h2>
        <a href="{% url 'add_step' goal.id %}" class="btn">+ Add Step</a>
      </div>

      {% if steps %}
        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
          {% for step in steps %}
            <div style="padding: 1rem; background: {% if step.is_completed %}linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border-left: 4px solid var(--success){% else %}var(--bg-primary){% endif %}; border-radius: 8px; display: flex; align-items: start; gap: 1rem; transition: var(--transition);">
              <div style="font-size: 1.5rem; margin-top: 0.25rem;">
                {% if step.is_completed %}âœ…{% else %}â­•{% endif %}
              </div>
              <div style="flex: 1;">
                <p style="margin: 0 0 0.5rem 0; {% if step.is_completed %}text-decoration: line-through; color: var(--text-muted);{% else %}color: var(--text-primary);{% endif %} font-weight: 500;">
                  {{ step.order }}. {{ step.title }}
                </p>
                <div style="display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0.75rem;">
                  <span style="display: inline-block; padding: 0.25rem 0.5rem; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 4px; font-size: 0.75rem; color: var(--text-muted);">
                    Level {{ step.difficulty }}
                  </span>
                  {% if step.fail_count > 0 %}
                  <span style="display: inline-block; padding: 0.25rem 0.5rem; background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); border-radius: 4px; font-size: 0.75rem; color: var(--danger);">
                    {{ step.fail_count }} fail{{ step.fail_count|pluralize }}
                  </span>
                  {% endif %}
                </div>
                {% if not step.is_completed %}
                <div style="display: flex; gap: 0.5rem;">
                  <a href="{% url 'do_step' step.id 'completed' %}" class="btn" style="flex: 1; padding: 0.5rem; font-size: 0.85rem;">âœ“ Done</a>
                  <a href="{% url 'do_step' step.id 'failed' %}" class="btn" style="flex: 1; padding: 0.5rem; font-size: 0.85rem; background: var(--danger)20; color: var(--danger);">âœ— Failed</a>
                </div>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p style="text-align: center; color: var(--text-muted); padding: 2rem;">No steps yet. <a href="{% url 'add_step' goal.id %}" style="color: var(--accent-primary); font-weight: 600;">Add your first step</a></p>
      {% endif %}
    </div>
  </div>

  <!-- Goal Info Sidebar -->
  <aside>
    <div class="card accent">
      <h3 style="margin-bottom: 1rem;">Goal Details</h3>
      <div style="display: flex; flex-direction: column; gap: 1rem;">
        <div>
          <p style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 0.25rem;">Status</p>
          <span style="display: inline-block; padding: 0.5rem 1rem; background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%); color: white; border-radius: 6px; font-weight: 600; font-size: 0.9rem;">
            {{ goal.status|upper }}
          </span>
        </div>
        <div style="border-bottom: 1px solid rgba(99, 102, 241, 0.2);"></div>
        <div>
          <p style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 0.25rem;">Priority</p>
          <span style="display: inline-block; padding: 0.5rem 1rem; background: var(--bg-secondary); border: 1.5px solid var(--border-color); border-radius: 6px; font-weight: 600; font-size: 0.9rem;">
            {{ goal.priority|upper }}
          </span>
        </div>
        <div style="border-bottom: 1px solid rgba(99, 102, 241, 0.2);"></div>
        <div>
          <p style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 0.25rem;">Total Steps</p>
          <p style="font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);">{{ steps.count }}</p>
        </div>
      </div>
    </div>

    <div class="card">
      <h4 style="margin-bottom: 1rem;">ğŸ¯ Real Progress</h4>
      <div style="width: 100%; height: 10px; background: var(--border-color); border-radius: 5px; overflow: hidden; margin-bottom: 0.75rem;">
        <div style="height: 100%; width: {{ progress_percent }}%; background: linear-gradient(90deg, var(--success) 0%, var(--info) 100%); transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);"></div>
      </div>
      <p style="font-weight: 700; font-size: 1.25rem; color: var(--text-primary); margin-bottom: 0.25rem;">
        {{ progress_percent }}%
      </p>
      <p style="color: var(--text-muted); font-size: 0.85rem; margin: 0;">
        {{ completed }} of {{ total }} steps complete
      </p>
      
      {% if goal.status == 'completed' %}
      <div style="margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border: 2px solid var(--success); border-radius: 8px; text-align: center;">
        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ‰</div>
        <p style="margin: 0; font-weight: 700; color: var(--success);">Goal Completed!</p>
      </div>
      {% endif %}
    </div>
  </aside>
</div>

{% endblock %}

{% extends 'core/base.html' %}
{% block title %}Dashboard - Progress Autopilot{% endblock %}
{% block content %}

<section class="section">
  <h1 style="margin-bottom: 0.5rem;">Welcome back, <span style="background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">{{ user.username }}</span></h1>
  
  <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
    <span style="font-weight: 600; padding: 0.5rem 1rem; background: var(--bg-secondary); border-radius: 6px; color: var(--accent-primary);">Level {{ level.level }}</span>
    <span style="color: var(--text-muted);">{{ user.userprofile.streak }} day streak ğŸ”¥ â€¢ {{ user.userprofile.xp }} XP earned</span>
  </div>
  
  {% if motivation_msg %}
  <div style="padding: 1rem; background: linear-gradient(135deg, var(--accent-primary)20 0%, var(--accent-secondary)20 100%); border-left: 4px solid var(--accent-primary); border-radius: 6px; color: var(--text-secondary); font-style: italic;">
    ğŸ’¡ {{ motivation_msg }}
  </div>
  {% endif %}
</section>

{% if next_step %}
<div class="row">
  <!-- Main Action Card -->
  <section class="card big accent">
    <div style="margin-bottom: 1.5rem;">
      <span class="goal">Next Step â€¢ Goal: {{ next_step.goal.title }}</span>
    </div>
    
    <div class="task">{{ next_step.title }}</div>
    
    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-primary); border-radius: 8px;">
      <span style="font-weight: 600; color: var(--text-primary);">Difficulty:</span>
      <span style="display: inline-block; padding: 0.25rem 0.75rem; background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%); color: white; border-radius: 999px; font-size: 0.85rem; font-weight: 600;">Level {{ next_step.difficulty }}</span>
    </div>

    <div class="actions">
      <a href="{% url 'do_step' next_step.id 'completed' %}" class="btn btn-done">âœ“ Done</a>
      <a href="{% url 'do_step' next_step.id 'failed' %}" class="btn btn-fail">âœ— Failed</a>
      <a href="{% url 'do_step' next_step.id 'skipped' %}" class="btn btn-skip">â†’ Skip</a>
    </div>
  </section>

  <!-- Sidebar Stats -->
  <aside>
    <!-- Energy Card -->
    <div class="card success">
      <h4 style="margin-bottom: 1rem;">âš¡ Energy Level</h4>
      <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; background: linear-gradient(135deg, var(--success) 0%, #059669 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
        {{ status.energy }}/10
      </div>
      <a href="{% url 'daily_status' %}" class="btn btn-secondary" style="width: 100%; justify-content: center;">Update</a>
    </div>

    <!-- Stats Card -->
    <div class="card">
      <h4 style="margin-bottom: 1.5rem;">ğŸ“Š Statistics</h4>
      <div style="display: flex; flex-direction: column; gap: 1rem;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <span style="color: var(--text-secondary);">Current Streak</span>
          <span style="font-weight: 700; font-size: 1.25rem; color: var(--accent-primary);">{{ user.userprofile.streak }}d</span>
        </div>
        <div style="border-bottom: 1px solid var(--border-color);"></div>
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <span style="color: var(--text-secondary);">Total XP</span>
          <span style="font-weight: 700; font-size: 1.25rem; color: var(--info);">{{ user.userprofile.xp }}</span>
        </div>
        <div style="border-bottom: 1px solid var(--border-color);"></div>
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <span style="color: var(--text-secondary);">Coins</span>
          <span style="font-weight: 700; font-size: 1.25rem; color: var(--warning);">{{ user.userprofile.coins }}</span>
        </div>
      </div>
    </div>
  </aside>
</div>

<!-- Story Section -->
<section class="card story">
  <h3>ğŸ“– Your Journey</h3>
  <p style="margin-bottom: 0;">{{ story }}</p>
</section>

{% else %}
<section class="card text-center">
  <h2>ğŸš€ Ready to start?</h2>
  <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">You haven't created any goals yet. Let's build your first milestone!</p>
  <a href="{% url 'goal_create' %}" class="btn">+ Create Your First Goal</a>
</section>
{% endif %}

<!-- Goals Progress Section -->
<section class="card">
  <h3 style="margin-bottom: 1.5rem;">ğŸ¯ Goal Progress</h3>
  {% if goals %}
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
      {% for item in goals %}
        <div style="padding: 1.5rem; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color); transition: transform 0.2s, box-shadow 0.2s;">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <a href="{% url 'goal_detail' item.goal.id %}" style="font-weight: 600; color: var(--text-primary); text-decoration: none; flex: 1;">{{ item.goal.title }}</a>
            <span style="font-size: 0.85rem; font-weight: 700; color: var(--accent-primary); padding: 0.25rem 0.75rem; background: var(--accent-primary)15; border-radius: 999px;">{{ item.score }}%</span>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
              <span style="font-size: 0.9rem; color: var(--text-secondary);">Real Progress</span>
              <span style="font-weight: 700; color: var(--accent-primary);">{{ item.progress }}%</span>
            </div>
            <div style="width: 100%; height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden;">
              <div style="height: 100%; width: {{ item.progress }}%; background: linear-gradient(90deg, var(--accent-primary) 0%, var(--accent-secondary) 100%); transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);"></div>
            </div>
          </div>
          
          <span style="font-size: 0.85rem; color: var(--text-muted);">
            {% if item.goal.status == 'completed' %}
              âœ… Completed
            {% else %}
              ğŸ“Œ {{ item.goal.steps.all|length }} steps
            {% endif %}
          </span>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p style="text-align: center; color: var(--text-muted);">No goals yet. <a href="{% url 'goal_create' %}">Create one</a></p>
  {% endif %}
</section>

<!-- Achievements Section -->
{% if achievements %}
<section class="card">
  <h3 style="margin-bottom: 1.5rem;">ğŸ† Achievements</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 1rem;">
    {% for achievement in achievements %}
      <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px; text-align: center; border: 2px solid var(--accent-primary)20; transition: all 0.2s;">
        <div style="font-size: 2rem; margin-bottom: 0.5rem;">{{ achievement.icon }}</div>
        <div style="font-weight: 600; font-size: 0.9rem; color: var(--text-primary); margin-bottom: 0.25rem;">{{ achievement.name }}</div>
        <div style="font-size: 0.8rem; color: var(--text-muted);">{{ achievement.desc }}</div>
      </div>
    {% endfor %}
  </div>
</section>
{% endif %}
{% endblock %}
